<!DOCTYPE html>
<html lang="zh">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../../css/mystyle.css">

    <script src="../../js/jquery-3.5.1.min.js"></script>
    <script src="../../plugin/layer/3.1.1/layer.js"></script>
    <script src="../../js/common.js"></script>
    <script src="../../js/my/dataTable.js"></script>

</head>
<body >
    <table id="dataTable"></table>
<script>
    $(function () {
        dataTable.init({
            target:"#dataTable",
            url:"../../store/projectList",
            column:[
                {title:"序号",name:"",width:"45px",class:"",res:function (index,res,data) {
                        return index+1;
                    }},
                {title:"项目名称",name:"projectName",width:"",class:"",res:function (index,res,data) {}},
                {title:"操作",name:"",width:"40px",class:"",res:function (index,res,data) {
                    if (strNotNull(res.state)) {
                        return '';
                    } else {
                        return '<a href="#" onclick="addProject('+res.projectId+',\''+res.projectName+'\')">添加</a>';
                    }
                }}
            ],
            beforeAjax:function () {
                var _data = {
                    pageSize: 10
                };
                return _data;
            }
        });
    });

    function addProject(id,name) {
        var _i = layer.confirm('是否确认添加['+name+']', {
            btn: ['确认', '取消']
        }, function(index, layero){
            loading();
            $.ajax({
                url:"../../store/buyProject?tm="+new Date().getTime(),
                type:"POST",
                data:{projectId:id},
                dataType:"JSON",
                success : function(res) {
                    if(res.code == 200 || res.code == 1001) {
                        dataTable.draw();
                    }else{
                        alert(res.message);
                    }
                },error:function (res) {
                    alert(res.message);
                },complete(XHR, TS) {
                    loadingClose();
                    layer.close(_i);
                }
            });
            loadingClose();

        });
    }
</script>
</body>
</html>
